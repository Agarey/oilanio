{"ast":null,"code":"var _jsxFileName = \"C:\\\\Server\\\\data\\\\htdocs\\\\oilanio-mirror-agarey\\\\pages\\\\cabinet\\\\index.js\";\nvar __jsx = React.createElement;\nimport styles from \"./style.module.css\";\nimport React, { useState, useEffect, useLayoutEffect } from \"react\";\nimport 'react-animated-slider/build/horizontal.css';\nimport CabinetMenu from \"../../src/components/Menu\";\nimport CabinetHeader from \"../../src/components/CabinetHeader\";\nimport ApplicationsBlock from \"../../src/components/ApplicationsBlock\";\nimport { default as axios } from \"axios\";\nimport globals from \"../../src/globals\";\nimport MyInfoBlock from \"../../src/components/MyInfoBlock\";\nimport StatisticsBlock from \"../../src/components/StatisticsBlock\";\nimport Head from \"next/head\";\nimport SubscriptionBlock from \"../../src/components/SubscriptionBlock\";\nimport { useRouter } from \"next/router\";\nimport style from \"../direction/direction.module.css\";\n\nfunction Cabinet() {\n  const menuItems = [{\n    title: 'Статистика',\n    index: 0\n  }, {\n    title: 'Заявки',\n    index: 1\n  }, {\n    title: 'Подписка',\n    index: 2\n  }, {\n    title: 'Моя информация',\n    index: 3\n  }];\n  const router = useRouter();\n  const {\n    0: activeMenuIndex,\n    1: setActiveMenuIndex\n  } = useState(0);\n  const {\n    0: courseCategories,\n    1: setCourseCategories\n  } = useState([]);\n  const {\n    0: subscriptionInfo,\n    1: setSubscriptionInfo\n  } = useState(null);\n  const {\n    0: courseCards,\n    1: setCourseCards\n  } = useState([]);\n  const {\n    0: directionsArray,\n    1: setDirectionsArray\n  } = useState([]);\n  const {\n    0: courseInfo,\n    1: setCourseInfo\n  } = useState(null);\n  const {\n    0: clickStatistics,\n    1: setClickStatistics\n  } = useState([]);\n  const {\n    0: applications,\n    1: setApplications\n  } = useState([]);\n  const {\n    0: teachers,\n    1: setTeachers\n  } = useState([]);\n  const {\n    0: newApplicationsCount,\n    1: setNewApplicationsCount\n  } = useState(0);\n\n  const getActivePage = () => {\n    switch (activeMenuIndex) {\n      case 0:\n        return __jsx(StatisticsBlock, {\n          applications: applications,\n          newApplicationsCount: newApplicationsCount,\n          clickStatistics: clickStatistics,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 38,\n            columnNumber: 24\n          }\n        });\n\n      case 1:\n        return __jsx(ApplicationsBlock, {\n          applications: applications,\n          courseInfo: courseInfo,\n          courseCards: courseCards,\n          directionsArray: directionsArray,\n          subscriptionInfo: subscriptionInfo,\n          categories: courseCategories,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 40,\n            columnNumber: 24\n          }\n        });\n\n      case 2:\n        return __jsx(SubscriptionBlock, {\n          courseInfo: courseInfo,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 42,\n            columnNumber: 24\n          }\n        });\n\n      case 3:\n        return __jsx(MyInfoBlock, {\n          teachers: teachers,\n          courseCategories: courseCategories,\n          courseInfo: courseInfo,\n          courseCards: courseCards,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 44,\n            columnNumber: 24\n          }\n        });\n\n      default:\n        return __jsx(React.Fragment, null);\n    }\n  };\n\n  const loadData = async () => {\n    let courseId = '';\n    let token = '';\n\n    if (localStorage.getItem(globals.localStorageKeys.centerId) != null) {\n      courseId = +localStorage.getItem(globals.localStorageKeys.centerId);\n      token = JSON.parse(localStorage.getItem(globals.localStorageKeys.authToken)).token;\n      await axios({\n        method: 'get',\n        url: `${globals.productionServerDomain}/courses/${+localStorage.getItem(globals.localStorageKeys.centerId)}`,\n        headers: {\n          'Authorization': `Bearer ${JSON.parse(localStorage.getItem(globals.localStorageKeys.authToken)).token}`\n        }\n      }).then(async function (res) {\n        await setCourseInfo(res.data[0]);\n      }).catch(() => {\n        router.push('/login');\n      });\n      await axios({\n        method: 'post',\n        url: `${globals.productionServerDomain}/courseCategories`\n      }).then(function (res) {\n        setCourseCategories(res.data);\n      });\n      await axios({\n        method: 'post',\n        url: `${globals.productionServerDomain}/cabinetCourseTeachers`,\n        data: {\n          courseId: courseId\n        },\n        headers: {\n          'Authorization': `Bearer ${JSON.parse(localStorage.getItem(\"auth token\")).token}`\n        }\n      }).then(function (res) {\n        setTeachers(res.data);\n      });\n      await axios({\n        method: 'post',\n        url: `${globals.productionServerDomain}/getApplicationResponsePermission`,\n        data: {\n          center_id: +localStorage.getItem(globals.localStorageKeys.centerId)\n        },\n        headers: {\n          'Authorization': `Bearer ${JSON.parse(localStorage.getItem(\"auth token\")).token}`\n        }\n      }).then(function (res) {\n        setSubscriptionInfo(res.data);\n      }).catch(() => {\n        router.push('/login');\n      });\n      let directionsArrayTemp = [];\n      await axios({\n        method: 'post',\n        url: `${globals.productionServerDomain}/cabinetCourseCards`,\n        data: {\n          courseId: +localStorage.getItem(globals.localStorageKeys.centerId)\n        },\n        headers: {\n          'Authorization': `Bearer ${JSON.parse(localStorage.getItem(globals.localStorageKeys.authToken)).token}`\n        }\n      }).then(function (res) {\n        setCourseCards(res.data);\n        res.data.map(item => {\n          if (directionsArrayTemp.indexOf(item.card_category_id) === -1) {\n            directionsArrayTemp.push(item.card_category_id);\n          }\n        });\n      }).finally(() => {\n        axios({\n          method: 'post',\n          url: `${globals.productionServerDomain}/getCourseSearchApplications`,\n          data: {\n            role_id: +localStorage.getItem(globals.localStorageKeys.roleId),\n            course_id: courseId\n          },\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        }).then(function (res) {\n          let applicationArray = [];\n          let newApplicationsCount = 0;\n          console.log('directionArray');\n          console.log(directionsArrayTemp);\n          res.data.map(item => {\n            if (directionsArrayTemp.includes(item.direction_id)) {\n              if (new Date(item.datetime).getTime() + 86400000 > new Date().getTime()) {\n                newApplicationsCount++;\n              }\n\n              applicationArray.push(item);\n            }\n          });\n          setApplications(applicationArray);\n          setNewApplicationsCount(newApplicationsCount);\n        }).catch(err => {\n          setApplications([]);\n        });\n      });\n      await axios({\n        method: 'post',\n        url: `${globals.productionServerDomain}/getClickStatistics`,\n        data: {\n          centerId: +localStorage.getItem(globals.localStorageKeys.centerId)\n        }\n      }).then(function (res) {\n        let cardClicks = [];\n        res.data.map(item => {\n          cardClicks.push(item.card_id);\n        });\n        let uniqueCards = [...new Set(cardClicks)];\n\n        for (let i = 0; i < uniqueCards.length; i++) {\n          let count = 0;\n          let cardTitle = null;\n          let cardCategoryName = null;\n          let cardId = uniqueCards[i];\n          let cardPrice = null;\n          let cardCurrency = null;\n          let cardUnitOfTime = null;\n          let cardIsOnline = null;\n\n          for (let click of res.data) {\n            if (click.card_id === cardId) {\n              count++;\n              cardTitle = click.title;\n              cardCategoryName = click.name;\n              cardPrice = click.price;\n              cardCurrency = click.currency;\n              cardUnitOfTime = click.unit_of_time;\n              cardIsOnline = click.isonline;\n            }\n          }\n\n          uniqueCards[i] = {\n            id: cardId,\n            title: cardTitle,\n            categoryName: cardCategoryName,\n            clicksCount: count,\n            price: cardPrice,\n            currency: cardCurrency,\n            unitOfTime: cardUnitOfTime,\n            isOnline: cardIsOnline\n          };\n        }\n\n        uniqueCards = uniqueCards.sort((a, b) => {\n          if (a.clicksCount > b.clicksCount) {\n            return -1;\n          } else {\n            return 1;\n          }\n        });\n        setClickStatistics(uniqueCards);\n      });\n    } else {\n      router.push('/login');\n    }\n  };\n\n  useLayoutEffect(() => {\n    if (localStorage.getItem(globals.localStorageKeys.centerId) != null) {\n      let roleId = +localStorage.getItem(globals.localStorageKeys.roleId);\n\n      if (roleId === 6) {\n        router.push('/cabinet/tutor');\n      }\n    }\n  }, []);\n  const {\n    0: showMenu,\n    1: setShowMenu\n  } = useState(false);\n  useEffect(async () => {\n    await loadData();\n  }, []);\n  return __jsx(\"div\", {\n    style: {\n      backgroundColor: '#FAF8FF'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 9\n    }\n  }, __jsx(Head, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 13\n    }\n  }, __jsx(\"title\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 17\n    }\n  }, \"Oilan - \\u041A\\u0430\\u0431\\u0438\\u043D\\u0435\\u0442\"), __jsx(\"link\", {\n    rel: \"icon\",\n    href: \"/atom-icon.png\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 17\n    }\n  })), courseInfo && __jsx(CabinetHeader, {\n    courseInfo: courseInfo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 29\n    }\n  }), __jsx(\"div\", {\n    className: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.menu,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 17\n    }\n  }, __jsx(CabinetMenu, {\n    items: menuItems,\n    activeItemIndex: activeMenuIndex,\n    setActiveItemCallback: setActiveMenuIndex,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 21\n    }\n  })), __jsx(\"div\", {\n    className: styles.content,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 17\n    }\n  }, getActivePage())));\n}\n\nexport default Cabinet;","map":{"version":3,"sources":["C:/Server/data/htdocs/oilanio-mirror-agarey/pages/cabinet/index.js"],"names":["styles","React","useState","useEffect","useLayoutEffect","CabinetMenu","CabinetHeader","ApplicationsBlock","default","axios","globals","MyInfoBlock","StatisticsBlock","Head","SubscriptionBlock","useRouter","style","Cabinet","menuItems","title","index","router","activeMenuIndex","setActiveMenuIndex","courseCategories","setCourseCategories","subscriptionInfo","setSubscriptionInfo","courseCards","setCourseCards","directionsArray","setDirectionsArray","courseInfo","setCourseInfo","clickStatistics","setClickStatistics","applications","setApplications","teachers","setTeachers","newApplicationsCount","setNewApplicationsCount","getActivePage","loadData","courseId","token","localStorage","getItem","localStorageKeys","centerId","JSON","parse","authToken","method","url","productionServerDomain","headers","then","res","data","catch","push","center_id","directionsArrayTemp","map","item","indexOf","card_category_id","finally","role_id","roleId","course_id","applicationArray","console","log","includes","direction_id","Date","datetime","getTime","err","cardClicks","card_id","uniqueCards","Set","i","length","count","cardTitle","cardCategoryName","cardId","cardPrice","cardCurrency","cardUnitOfTime","cardIsOnline","click","name","price","currency","unit_of_time","isonline","id","categoryName","clicksCount","unitOfTime","isOnline","sort","a","b","showMenu","setShowMenu","backgroundColor","container","menu","content"],"mappings":"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","sourcesContent":["import styles from \"./style.module.css\";\r\nimport React, {useState, useEffect, useLayoutEffect} from \"react\";\r\nimport 'react-animated-slider/build/horizontal.css'\r\nimport CabinetMenu from \"../../src/components/Menu\";\r\nimport CabinetHeader from \"../../src/components/CabinetHeader\";\r\nimport ApplicationsBlock from \"../../src/components/ApplicationsBlock\";\r\nimport {default as axios} from \"axios\";\r\nimport globals from \"../../src/globals\";\r\nimport MyInfoBlock from \"../../src/components/MyInfoBlock\";\r\nimport StatisticsBlock from \"../../src/components/StatisticsBlock\";\r\nimport Head from \"next/head\";\r\nimport SubscriptionBlock from \"../../src/components/SubscriptionBlock\";\r\nimport {useRouter} from \"next/router\";\r\nimport style from \"../direction/direction.module.css\";\r\n\r\nfunction Cabinet(){\r\n    const menuItems = [\r\n        {title: 'Статистика', index: 0},\r\n        {title: 'Заявки', index: 1},\r\n        {title: 'Подписка', index: 2},\r\n        {title: 'Моя информация', index: 3}\r\n    ];\r\n    const router = useRouter();\r\n    const [activeMenuIndex, setActiveMenuIndex] = useState(0);\r\n    const [courseCategories, setCourseCategories] = useState([]);\r\n    const [subscriptionInfo, setSubscriptionInfo] = useState(null);\r\n    const [courseCards, setCourseCards] = useState([]);\r\n    const [directionsArray, setDirectionsArray] = useState([]);\r\n    const [courseInfo, setCourseInfo] = useState(null);\r\n    const [clickStatistics, setClickStatistics] = useState([]);\r\n    const [applications, setApplications] = useState([]);\r\n    const [teachers, setTeachers] = useState([]);\r\n    const [newApplicationsCount, setNewApplicationsCount] = useState(0);\r\n\r\n    const getActivePage = () => {\r\n        switch(activeMenuIndex){\r\n            case 0:\r\n                return(<StatisticsBlock applications={applications} newApplicationsCount={newApplicationsCount} clickStatistics={clickStatistics}/>)\r\n            case 1:\r\n                return(<ApplicationsBlock applications={applications} courseInfo={courseInfo} courseCards={courseCards} directionsArray={directionsArray} subscriptionInfo={subscriptionInfo} categories={courseCategories}/>);\r\n            case 2:\r\n                return(<SubscriptionBlock courseInfo={courseInfo}/>)\r\n            case 3:\r\n                return(<MyInfoBlock teachers={teachers} courseCategories={courseCategories} courseInfo={courseInfo} courseCards={courseCards}/>);\r\n            default:\r\n                return(<></>);\r\n        }\r\n    }\r\n\r\n    const loadData = async () => {\r\n        let courseId = '';\r\n        let token = '';\r\n\r\n        if(localStorage.getItem(globals.localStorageKeys.centerId) != null){\r\n            courseId = +localStorage.getItem(globals.localStorageKeys.centerId);\r\n            token = JSON.parse(localStorage.getItem(globals.localStorageKeys.authToken)).token;\r\n\r\n            await axios({\r\n                method: 'get',\r\n                url: `${globals.productionServerDomain}/courses/${+localStorage.getItem(globals.localStorageKeys.centerId)}`,\r\n                headers: {\r\n                    'Authorization': `Bearer ${JSON.parse(localStorage.getItem(globals.localStorageKeys.authToken)).token}`\r\n                }\r\n            }).then(async function(res){\r\n                await setCourseInfo(res.data[0]);\r\n            }).catch(() => {\r\n                router.push('/login');\r\n            });\r\n\r\n            await axios({\r\n                method: 'post',\r\n                url: `${globals.productionServerDomain}/courseCategories`,\r\n            }).then(function(res){\r\n                setCourseCategories(res.data)\r\n            });\r\n\r\n            await axios({\r\n                method: 'post',\r\n                url: `${globals.productionServerDomain}/cabinetCourseTeachers`,\r\n                data: {\r\n                    courseId: courseId\r\n                },\r\n                headers: {\r\n                    'Authorization': `Bearer ${JSON.parse(localStorage.getItem(\"auth token\")).token}`\r\n                }\r\n            }).then(function(res){\r\n                setTeachers(res.data)\r\n            });\r\n\r\n            await axios({\r\n                method: 'post',\r\n                url: `${globals.productionServerDomain}/getApplicationResponsePermission`,\r\n                data: {\r\n                    center_id: +localStorage.getItem(globals.localStorageKeys.centerId)\r\n                },\r\n                headers: {\r\n                    'Authorization': `Bearer ${JSON.parse(localStorage.getItem(\"auth token\")).token}`\r\n                }\r\n            }).then(function(res){\r\n                setSubscriptionInfo(res.data);\r\n            }).catch(() => {\r\n                router.push('/login');\r\n            });\r\n\r\n            let directionsArrayTemp = [];\r\n\r\n            await axios({\r\n                method: 'post',\r\n                url: `${globals.productionServerDomain}/cabinetCourseCards`,\r\n                data: {\r\n                    courseId: +localStorage.getItem(globals.localStorageKeys.centerId)\r\n                },\r\n                headers: {\r\n                    'Authorization': `Bearer ${JSON.parse(localStorage.getItem(globals.localStorageKeys.authToken)).token}`\r\n                }\r\n            }).then(function(res){\r\n                setCourseCards(res.data);\r\n\r\n\r\n                res.data.map(item => {\r\n                    if(directionsArrayTemp.indexOf(item.card_category_id) === -1){\r\n                        directionsArrayTemp.push(item.card_category_id);\r\n                    }\r\n                })\r\n\r\n            }).finally(() => {\r\n                axios({\r\n                    method: 'post',\r\n                    url: `${globals.productionServerDomain}/getCourseSearchApplications`,\r\n                    data: {\r\n                        role_id: +localStorage.getItem(globals.localStorageKeys.roleId),\r\n                        course_id: courseId\r\n                    },\r\n                    headers: {\r\n                        'Authorization': `Bearer ${token}`\r\n                    }\r\n                }).then(function(res){\r\n                    let applicationArray = [];\r\n                    let newApplicationsCount = 0;\r\n\r\n                    console.log('directionArray')\r\n                    console.log(directionsArrayTemp);\r\n\r\n                    res.data.map(item => {\r\n                        if(directionsArrayTemp.includes(item.direction_id)){\r\n                            if((new Date(item.datetime).getTime() + 86400000) > (new Date().getTime())){\r\n                                newApplicationsCount++;\r\n                            }\r\n                            applicationArray.push(item);\r\n                        }\r\n                    })\r\n\r\n                    setApplications(applicationArray);\r\n                    setNewApplicationsCount(newApplicationsCount);\r\n                }).catch((err)=>{\r\n                    setApplications([])\r\n                })\r\n            });\r\n\r\n            await axios({\r\n                method: 'post',\r\n                url: `${globals.productionServerDomain}/getClickStatistics`,\r\n                data: {\r\n                    centerId: +localStorage.getItem(globals.localStorageKeys.centerId)\r\n                }\r\n            }).then(function(res){\r\n                let cardClicks = [];\r\n\r\n                res.data.map((item) => {\r\n                    cardClicks.push(item.card_id);\r\n                })\r\n\r\n                let uniqueCards = [...new Set(cardClicks)];\r\n\r\n                for(let i = 0; i < uniqueCards.length; i++){\r\n                    let count = 0;\r\n                    let cardTitle = null;\r\n                    let cardCategoryName = null;\r\n                    let cardId = uniqueCards[i];\r\n                    let cardPrice = null;\r\n                    let cardCurrency = null;\r\n                    let cardUnitOfTime = null;\r\n                    let cardIsOnline = null;\r\n\r\n                    for(let click of res.data){\r\n                        if(click.card_id === cardId){\r\n                            count++;\r\n                            cardTitle = click.title;\r\n                            cardCategoryName = click.name;\r\n                            cardPrice = click.price;\r\n                            cardCurrency = click.currency;\r\n                            cardUnitOfTime = click.unit_of_time;\r\n                            cardIsOnline = click.isonline;\r\n                        }\r\n                    }\r\n\r\n                    uniqueCards[i] = {\r\n                        id: cardId,\r\n                        title: cardTitle,\r\n                        categoryName: cardCategoryName,\r\n                        clicksCount: count,\r\n                        price: cardPrice,\r\n                        currency: cardCurrency,\r\n                        unitOfTime: cardUnitOfTime,\r\n                        isOnline: cardIsOnline\r\n                    }\r\n                }\r\n\r\n                uniqueCards = uniqueCards.sort((a, b) => {\r\n                    if(a.clicksCount > b.clicksCount){\r\n                        return -1;\r\n                    }else {\r\n                        return 1;\r\n                    }\r\n                })\r\n\r\n                setClickStatistics(uniqueCards);\r\n            });\r\n        } else{\r\n            router.push('/login');\r\n        }\r\n    }\r\n    useLayoutEffect(() =>{\r\n        if(localStorage.getItem(globals.localStorageKeys.centerId) != null) {\r\n            let roleId = +localStorage.getItem(globals.localStorageKeys.roleId);\r\n            if(roleId === 6) {\r\n                router.push('/cabinet/tutor')\r\n            }\r\n        }\r\n    }, [])\r\n\r\n    const [showMenu, setShowMenu] = useState(false);\r\n\r\n    useEffect(async () => {\r\n        await loadData();\r\n    }, [])\r\n\r\n    return (\r\n        <div style={{backgroundColor: '#FAF8FF'}}>\r\n            <Head>\r\n                <title>Oilan - Кабинет</title>\r\n                <link rel=\"icon\" href=\"/atom-icon.png\" />\r\n            </Head>\r\n            {courseInfo && (<CabinetHeader courseInfo={courseInfo}/>)}\r\n\r\n            <div className={styles.container}>\r\n                <div className={styles.menu}>\r\n                    <CabinetMenu items={menuItems} activeItemIndex={activeMenuIndex} setActiveItemCallback={setActiveMenuIndex}/>\r\n                </div>\r\n                <div className={styles.content}>\r\n                    {\r\n                        getActivePage()\r\n                    }\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Cabinet;\r\n"]},"metadata":{},"sourceType":"module"}